using FluentAssertions;
using HtmlAgilityPack;
using Microsoft.Extensions.Options;
using WonderfullOffer.Api.Models.Settings.PageProcessSettings.Amazon;
using WonderfullOffers.Domain.Contracts.Domain.Processors.ExtractorProcessBase;
using WonderfullOffers.Tests.UnitTest.Hosting;

namespace WonderfullOffers.Tests.UnitTest.Domain.PageProcess.ExtractorProcess;

public class ExtractorBaseProcessTest
{
    private readonly Host _host;
    private readonly IExtractorProcess _sut;
    private readonly AmazonSettings _amazonPageProcessSettings;

    public ExtractorBaseProcessTest()
    {
        _host = new();
        _sut = _host.GetService<IExtractorProcess>();
        _amazonPageProcessSettings = _host.GetService<IOptions<AmazonSettings>>().Value;
    }

    //[Theory]
    //[InlineData("<div id=\"desktop-grid-1\" data-gwi=\"{&quot;visible&quot;:&quot;desktop-grid-1-visible&quot;,&quot;active&quot;:&quot;desktop-grid-1-active&quot;}\" data-display-at=\"smws\" data-order-ws=\"1\" class=\"gw-col csm-placement-id-7d79bf2b-4e72-4144-a0f7-58bd209cc2de desktop-gateway-atf_27e028f7-88b1-4b9e-a69e-99340d047a7b celwidget pd_rd_wg-50n2T pd_rd_w-9NEAr pd_rd_r-3ed2e4d0-46a9-475d-af1c-9f4a474b75b0\" data-order-sm=\"1\" data-pf_rd_p=\"7d79bf2b-4e72-4144-a0f7-58bd209cc2de\" data-pd_rd_wg=\"50n2T\" data-pd_rd_w=\"9NEAr\" data-pd_rd_r=\"3ed2e4d0-46a9-475d-af1c-9f4a474b75b0\" data-ref_=\"pd_gw_unk\" data-csa-op-logger-render=\"\" data-csa-c-type=\"widget\" data-csa-c-slot-id=\"desktop-grid-1\" data-csa-c-content-id=\"amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de\" data-csa-c-painter=\"fluid-fat-image-link-v2\" data-csa-c-id=\"hgyxiy-2242uc-rz2x16-ja08mq\" data-cel-widget=\"desktop-grid-1\"><style>._fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J{-webkit-box-orient:vertical;-webkit-box-direction:normal;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}._fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:275px;margin-bottom:44px;padding:0 20px}._fluid-fat-image-link-v2_style_mergedLinks__10JqZ{-webkit-box-orient:inherit;-webkit-box-direction:inherit;display:inherit;-ms-flex-direction:inherit;flex-direction:inherit;height:100%}\r\n    ._fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr{height:100%;overflow:hidden;position:relative;width:100%}._fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr ._fluid-fat-image-link-v2_style_fluidImage__gTBjA{margin:auto;position:absolute}._fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr ._fluid-fat-image-link-v2_style_fluidImage__gTBjA._fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK{height:100%;left:-9999px;max-width:none;right:-9999px}._fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr ._fluid-fat-image-link-v2_style_fluidImage__gTBjA._fluid-fat-image-link-v2_style_fluidPortraitImage__2SAYm{bottom:-9999px;max-height:none;top:-9999px;width:100%}\r\n    ._fluid-fat-image-link-v2_style_centerImage__30wh-{height:100%;width:100%}._fluid-fat-image-link-v2_style_imageLabel__3ANSV{height:36px}</style>\r\n    <!--CardsClient-->\r\n    <div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstanceol3w-vaba8HKp4y3pnhs2A\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_0\">\r\n        <div class=\"a-cardui-header\">\r\n            <h2 class=\"a-color-base headline truncate-2line\">Ofertas flash</h2>\r\n        </div>\r\n        <a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/gp/goldbox/?ie=UTF8&amp;ref_=sv__2&amp;deals-widget=%257B%2522version%2522%253A1%252C%2522viewIndex%2522%253A0%252C%2522presetId%2522%253A%2522deals-collection-lightning-deals%2522%252C%2522dealType%2522%253A%2522LIGHTNING_DEAL%2522%252C%2522sorting%2522%253A%2522BY_SCORE%2522%257D&amp;pd_rd_w=9NEAr&amp;content-id=amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_p=7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_r=2YJ5BWY1ZYK216W10GPS&amp;pd_rd_wg=50n2T&amp;pd_rd_r=3ed2e4d0-46a9-475d-af1c-9f4a474b75b0\">\r\n            <div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\">\r\n                <div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\">\r\n                    <img alt=\"Ofertas flash\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_379x304_es-es._SY304_CB589219091_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_758x608_es-es._SY608_CB589219091_.jpg\">\r\n                </div>\r\n            </div>\r\n            <div class=\"a-cardui-footer\">\r\n                <span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\">\r\n                    <span class=\"a-truncate-full a-offscreen\">Explora ahora</span>\r\n                    <span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span>\r\n                </span>\r\n            </div>\r\n        </a>\r\n    </div>\r\n    <script>(function(f){f(P._namespace('gwiAutoInstVisible'));}(function(P) {if(window.GWI){GWI.Card.autoInstVisible('CardInstanceol3w-vaba8HKp4y3pnhs2A');}}));</script>\r\n</div>",
    //    "/gp/goldbox/?ie=UTF8&amp;ref_=sv__2&amp;deals-widget=%257B%2522version%2522%253A1%252C%2522viewIndex%2522%253A0%252C%2522presetId%2522%253A%2522deals-collection-lightning-deals%2522%252C%2522dealType%2522%253A%2522LIGHTNING_DEAL%2522%252C%2522sorting%2522%253A%2522BY_SCORE%2522%257D&amp;pd_rd_w=9NEAr&amp;content-id=amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_p=7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_r=2YJ5BWY1ZYK216W10GPS&amp;pd_rd_wg=50n2T&amp;pd_rd_r=3ed2e4d0-46a9-475d-af1c-9f4a474b75b0"
    //)]
    //public async void Should_Extract_Uri(
    //    string inputHtml,
    //    string resultHtml)
    //{
    //    resultHtml = $"{_amazonPageProcessSettings.MainDomainUri}{resultHtml}";
    //    HtmlDocument htmlDocument = new();
    //    htmlDocument.LoadHtml(inputHtml);

    //    Uri expected = await _sut.ExtractUriAsync(
    //        htmlDocument.DocumentNode,
    //        _amazonPageProcessSettings.MainDomainUri);


    //    resultHtml.Should().BeEquivalentTo(expected.OriginalString);
    //}

    [Theory]
    [InlineData("<div id=\"corePriceDisplay_desktop_feature_div\" class=\"celwidget\" data-feature-name=\"corePriceDisplay_desktop\" data-csa-c-type=\"widget\" data-csa-c-content-id=\"corePriceDisplay_desktop\" data-csa-c-slot-id=\"corePriceDisplay_desktop_feature_div\" data-csa-c-asin=\"B0BQ68H284\" data-csa-c-is-in-initial-active-row=\"false\" data-csa-c-id=\"o7m70t-sr4mn6-uijy2t-omolgm\" data-cel-widget=\"corePriceDisplay_desktop_feature_div\">\r\n                                           <style type=\"text/css\">\r\n    .savingPriceOverride {\r\n        color:#CC0C39!important;\r\n        font-weight: 300!important;\r\n    }\r\n</style>\r\n\r\n                              <div class=\"a-section a-spacing-none aok-align-center\">       <span aria-hidden=\"false\" class=\"a-size-large a-color-price savingPriceOverride aok-align-center reinventPriceSavingsPercentageMargin savingsPercentage\">-15&nbsp;%</span>         <span class=\"a-price aok-align-center reinventPricePriceToPayMargin priceToPay\" data-a-size=\"xl\" data-a-color=\"base\"><span class=\"a-offscreen\">169,15€</span><span aria-hidden=\"true\"><span class=\"a-price-whole\">169<span class=\"a-price-decimal\">,</span></span><span class=\"a-price-fraction\">15</span><span class=\"a-price-symbol\">€</span></span></span>              <span id=\"taxInclusiveMessage\" class=\"a-size-mini a-color-base aok-align-center aok-nowrap\">  </span>          </div>  <div class=\"a-section a-spacing-small aok-align-center\"> <span> <span class=\"aok-relative\"><span aria-hidden=\"false\" class=\"a-size-small a-color-secondary aok-align-center basisPrice\">Precio recomendado:          <span class=\"a-price a-text-price\" data-a-size=\"s\" data-a-strike=\"true\" data-a-color=\"secondary\"></span></span></span> <span class=\"a-size-small aok-align-center basisPriceLegalMessage\">                        <span class=\"a-declarative\" data-action=\"a-popover\" data-csa-c-type=\"widget\" data-csa-c-func-deps=\"aui-da-a-popover\" data-a-popover=\"{&quot;closeButton&quot;:&quot;true&quot;,&quot;name&quot;:&quot;basisPriceLegalMessageDisplayPreload&quot;,&quot;position&quot;:&quot;triggerBottom&quot;}\" data-csa-c-id=\"1nccr-g9efd3-jxnjq-5ubjoc\">    <a href=\"javascript:void(0)\" role=\"button\" class=\"a-popover-trigger a-declarative reinventPriceLegalMessagePopover\">   <script>\r\n                                    P.when('A').execute(function(A){\r\n                                        A.on(\"a:popover:beforeShow:basisPriceLegalMessageDisplayPreload\", function(data) {\r\n                                            ue.trigger('OFFERSX_TOOLTIP_POSITION_UPDATE_561323', 'T1');\r\n                                        })\r\n                                    });\r\n                                </script>\r\n                                <svg aria-hidden=\"true\" class=\"reinventPrice_legalMessage_icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\r\n                                    <path d=\"M256,9C119,9,8,120.08,8,257S119,505,256,505,504,394,504,257,393,9,256,9Zm0,76.31A47.69,47.69,0,1,1,208.31,133,47.69,47.69,0,0,1,256,85.31Zm38.15,332.38a12.18,12.18,0,0,1-12.21,12H229.67a11.85,11.85,0,0,1-11.82-12V249.92a11.86,11.86,0,0,1,11.82-12h52.27a12.18,12.18,0,0,1,12.21,12Z\"></path>\r\n                                </svg>\r\n                               <i class=\"a-icon a-icon-popover\"></i></a>   </span> <div class=\"a-popover-preload\" id=\"a-popover-basisPriceLegalMessageDisplayPreload\"> <div class=\"a-section a-spacing-none\"> <h3></h3> <span class=\"a-size-base\">El <b>PVPR</b> o <b>Precio recomendado</b> es el precio al  que el fabricante recomienda vender el producto y que ha sido proporcionado por el fabricante,  distribuidor u otro vendedor.<br><a class=\"a-link-normal\" href=\"https://www.amazon.es/gp/help/customer/display.html?language=es_ES&amp;nodeId=GQ6B6RH72AX8D2TD&amp;ref_=dp_hp\">Más información</a></span> </div> </div>    <style type=\"text/css\">\r\n    .reinventPrice_legalMessage_icon {\r\n        width: 12px;\r\n        fill: #969696;\r\n        vertical-align: middle;\r\n        padding-bottom: 2px;\r\n    }\r\n\r\n    .reinventPrice_legalMessage_icon:hover {\r\n        fill: #555555;\r\n    }\r\n</style>\r\n\r\n<script type=\"text/javascript\">\r\n    P.when('A', 'a-popover').execute('a-popover-count', function (A) {\r\n        A.declarative('a-popover', 'mouseenter', function() {\r\n            ue.count(\"tooltip.popover.opened\", 1);\r\n        });\r\n    });\r\n</script>  </span> </span> </div>                                        </div>",
        "//span[contains(@class,'a-offscreen')]",
        169.15
    )]
    public async void Should_Extract_Price_Without_Discount(
        string inputHtml,
        string filter,
        decimal resultHtml)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        decimal expected = await _sut.ExtractPriceAsync(
            htmlDocument.DocumentNode,
            filter);


        resultHtml.Should().Be(expected);
    }

    [Theory]
    [InlineData("<div id=\"corePriceDisplay_desktop_feature_div\" class=\"celwidget\" data-feature-name=\"corePriceDisplay_desktop\" data-csa-c-type=\"widget\" data-csa-c-content-id=\"corePriceDisplay_desktop\" data-csa-c-slot-id=\"corePriceDisplay_desktop_feature_div\" data-csa-c-asin=\"B0BQ68H284\" data-csa-c-is-in-initial-active-row=\"false\" data-csa-c-id=\"o7m70t-sr4mn6-uijy2t-omolgm\" data-cel-widget=\"corePriceDisplay_desktop_feature_div\">\r\n                                           <style type=\"text/css\">\r\n    .savingPriceOverride {\r\n        color:#CC0C39!important;\r\n        font-weight: 300!important;\r\n    }\r\n</style>\r\n\r\n                              <div class=\"a-section a-spacing-none aok-align-center\">       <span aria-hidden=\"false\" class=\"a-size-large a-color-price savingPriceOverride aok-align-center reinventPriceSavingsPercentageMargin savingsPercentage\">-15&nbsp;%</span>         <span class=\"a-price aok-align-center reinventPricePriceToPayMargin priceToPay\" data-a-size=\"xl\" data-a-color=\"base\"><span class=\"a-offscreen\">190,10€</span><span aria-hidden=\"true\"><span class=\"a-price-whole\">150,10€<span class=\"a-price-decimal\">,</span></span><span class=\"a-price-fraction\">15</span><span class=\"a-price-symbol\">€</span></span></span>              <span id=\"taxInclusiveMessage\" class=\"a-size-mini a-color-base aok-align-center aok-nowrap\">  </span>          </div>  <div class=\"a-section a-spacing-small aok-align-center\"> <span> <span class=\"aok-relative\"><span aria-hidden=\"false\" class=\"a-size-small a-color-secondary aok-align-center basisPrice\">Precio recomendado:          <span class=\"a-price a-text-price\" data-a-size=\"s\" data-a-strike=\"true\" data-a-color=\"secondary\"></span></span></span> <span class=\"a-size-small aok-align-center basisPriceLegalMessage\">                        <span class=\"a-declarative\" data-action=\"a-popover\" data-csa-c-type=\"widget\" data-csa-c-func-deps=\"aui-da-a-popover\" data-a-popover=\"{&quot;closeButton&quot;:&quot;true&quot;,&quot;name&quot;:&quot;basisPriceLegalMessageDisplayPreload&quot;,&quot;position&quot;:&quot;triggerBottom&quot;}\" data-csa-c-id=\"1nccr-g9efd3-jxnjq-5ubjoc\">    <a href=\"javascript:void(0)\" role=\"button\" class=\"a-popover-trigger a-declarative reinventPriceLegalMessagePopover\">   <script>\r\n                                    P.when('A').execute(function(A){\r\n                                        A.on(\"a:popover:beforeShow:basisPriceLegalMessageDisplayPreload\", function(data) {\r\n                                            ue.trigger('OFFERSX_TOOLTIP_POSITION_UPDATE_561323', 'T1');\r\n                                        })\r\n                                    });\r\n                                </script>\r\n                                <svg aria-hidden=\"true\" class=\"reinventPrice_legalMessage_icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\r\n                                    <path d=\"M256,9C119,9,8,120.08,8,257S119,505,256,505,504,394,504,257,393,9,256,9Zm0,76.31A47.69,47.69,0,1,1,208.31,133,47.69,47.69,0,0,1,256,85.31Zm38.15,332.38a12.18,12.18,0,0,1-12.21,12H229.67a11.85,11.85,0,0,1-11.82-12V249.92a11.86,11.86,0,0,1,11.82-12h52.27a12.18,12.18,0,0,1,12.21,12Z\"></path>\r\n                                </svg>\r\n                               <i class=\"a-icon a-icon-popover\"></i></a>   </span> <div class=\"a-popover-preload\" id=\"a-popover-basisPriceLegalMessageDisplayPreload\"> <div class=\"a-section a-spacing-none\"> <h3></h3> <span class=\"a-size-base\">El <b>PVPR</b> o <b>Precio recomendado</b> es el precio al  que el fabricante recomienda vender el producto y que ha sido proporcionado por el fabricante,  distribuidor u otro vendedor.<br><a class=\"a-link-normal\" href=\"https://www.amazon.es/gp/help/customer/display.html?language=es_ES&amp;nodeId=GQ6B6RH72AX8D2TD&amp;ref_=dp_hp\">Más información</a></span> </div> </div>    <style type=\"text/css\">\r\n    .reinventPrice_legalMessage_icon {\r\n        width: 12px;\r\n        fill: #969696;\r\n        vertical-align: middle;\r\n        padding-bottom: 2px;\r\n    }\r\n\r\n    .reinventPrice_legalMessage_icon:hover {\r\n        fill: #555555;\r\n    }\r\n</style>\r\n\r\n<script type=\"text/javascript\">\r\n    P.when('A', 'a-popover').execute('a-popover-count', function (A) {\r\n        A.declarative('a-popover', 'mouseenter', function() {\r\n            ue.count(\"tooltip.popover.opened\", 1);\r\n        });\r\n    });\r\n</script>  </span> </span> </div>                                        </div>",
        "//span[contains(@class,'a-price-whole')]",
        150.10
    )]
    public async void Should_Extract_Price_Within_Discount(
        string inputHtml,
        string filter,
        decimal resultHtml)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        decimal expected = await _sut.ExtractPriceAsync(
            htmlDocument.DocumentNode,
            filter);

        resultHtml.Should().Be(expected);
    }

    [Theory]
    [InlineData("<div aria-label=\"Oferta: proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche; \" class=\"DealCard-module__card_1u9yKYV4EIA-fL4ibeMVIU DealCard-module__cardWithoutActionButton_1K_FldevdoXxE8uy5pzBmr\" data-testid=\"deal-card\" data-deal-id=\"b888d7c2\" data-csa-c-type=\"item\" data-csa-c-item-type=\"deal\" data-csa-c-item-id=\"amzn1.deal.b888d7c2\" data-csa-c-painter=\"deals-grid\" data-csa-c-posx=\"1\" data-csa-c-owner=\"DealsX\" data-csa-c-id=\"nzbsql-gw0xeb-xmp7fe-drmw48\"><a class=\"a-link-normal DealCard-module__linkOutlineOffset_2fc037WfeGSjbFp1CAhOUn\" href=\"https://www.amazon.es/proscenic-P12-Aspiradora-Anti-enredos-VertectTM/dp/B0BQ68H284?pf_rd_r=Y0KCHM504D0X5FJK6SEB&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_img_0_b888d7c2_dt_sl14_3d\"><div class=\"DealCard-module__cardImageVertical_1m9E6mjbE6UbrGJwvn6GKM DealCard-module__imageWithPadding_Qk9F2b8bUeXPk8FUBnSVG\"><div class=\"a-image-container a-dynamic-image-container aok-align-center-horizontally DealImage-module__image_1aM-S1pMSsajamWgCRXa6y DealImage-module__imageAspectRatioFix_DJdrM5BSpMhSiPB6czCA4\"><img alt=\"proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para...\" src=\"https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF226,226_FMjpg_.jpg\" class=\"DealImage-module__imageObjectFit_1G4pEkUEzo9WEnA3Wl0XFv\" data-a-hires=\"https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF452,452_FMjpg_.jpg\"></div></div></a><div class=\"DealCard-module__contentWithPadding_1mEcEYf1DvbvZJ9zcQCxtw\"><span aria-live=\"off\" class=\"a-size-mini a-color-base\"><div class=\"BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><div class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Finaliza en 05:38:09</div></div><div class=\"BadgeAutomated-module__badgeLayoutCheck_1J0nKx-ocgm90oYWcNYv5F BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\" aria-hidden=\"true\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><div class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Finaliza en 05:38:09</div></div></span><a class=\"a-link-normal DealLink-module__dealLink_3v4tPYOP4qJj9bdiy0xAT a-color-base a-text-normal\" href=\"https://www.amazon.es/proscenic-P12-Aspiradora-Anti-enredos-VertectTM/dp/B0BQ68H284?pf_rd_r=Y0KCHM504D0X5FJK6SEB&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_tlt_0_b888d7c2_dt_sl14_3d\"><div class=\"DealContent-module__truncate_sWbxETx42ZPStTc9jwySW\">proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche</div></a><div class=\"a-row a-spacing-mini a-spacing-top-mini\"><span class=\"a-size-mini\"><div class=\"a-row a-spacing-top-micro\"><div class=\"ClaimedBar-module__bar_dm5aQ4mEyoaAHPKmolQmj\"><div class=\"ClaimedBar-module__filledBar_1RO2f4X1ENHj4qsxa7d6Ru\" style=\"width: 25%;\"></div></div><div class=\"a-row a-spacing-top-micro\"><span class=\"ClaimedBar-module__timerAndPercent_1W9_nt8c4k-Wlr-jz6Ak0f\"><div class=\"ClaimedBar-module__claimedPercentage_3qHVj_qhJeDemUDuoEw6-N\">25% solicitado</div></span></div></div></span></div></div></div>",
        "https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF226,226_FMjpg_.jpg"
    )]
    public async void Should_Extract_Img(
        string inputHtml,
        string resultHtml)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        Uri expected = await _sut.ExtractImgAsync(
            htmlDocument.DocumentNode);


        resultHtml.Should().Be(expected.OriginalString);
    }

    [Theory]
    [InlineData("<div aria-label=\"Oferta: proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche; \" class=\"DealCard-module__card_1u9yKYV4EIA-fL4ibeMVIU DealCard-module__cardWithoutActionButton_1K_FldevdoXxE8uy5pzBmr\" data-testid=\"deal-card\" data-deal-id=\"b888d7c2\" data-csa-c-type=\"item\" data-csa-c-item-type=\"deal\" data-csa-c-item-id=\"amzn1.deal.b888d7c2\" data-csa-c-painter=\"deals-grid\" data-csa-c-posx=\"1\" data-csa-c-owner=\"DealsX\" data-csa-c-id=\"nzbsql-gw0xeb-xmp7fe-drmw48\"><a class=\"a-link-normal DealCard-module__linkOutlineOffset_2fc037WfeGSjbFp1CAhOUn\" href=\"https://www.amazon.es/proscenic-P12-Aspiradora-Anti-enredos-VertectTM/dp/B0BQ68H284?pf_rd_r=Y0KCHM504D0X5FJK6SEB&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_img_0_b888d7c2_dt_sl14_3d\"><div class=\"DealCard-module__cardImageVertical_1m9E6mjbE6UbrGJwvn6GKM DealCard-module__imageWithPadding_Qk9F2b8bUeXPk8FUBnSVG\"><div class=\"a-image-container a-dynamic-image-container aok-align-center-horizontally DealImage-module__image_1aM-S1pMSsajamWgCRXa6y DealImage-module__imageAspectRatioFix_DJdrM5BSpMhSiPB6czCA4\"><img alt=\"proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para...\" src=\"https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF226,226_FMjpg_.jpg\" class=\"DealImage-module__imageObjectFit_1G4pEkUEzo9WEnA3Wl0XFv\" data-a-hires=\"https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF452,452_FMjpg_.jpg\"></div></div></a><div class=\"DealCard-module__contentWithPadding_1mEcEYf1DvbvZJ9zcQCxtw\"><span aria-live=\"off\" class=\"a-size-mini a-color-base\"><div class=\"BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><div class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Finaliza en 05:38:09</div></div><div class=\"BadgeAutomated-module__badgeLayoutCheck_1J0nKx-ocgm90oYWcNYv5F BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\" aria-hidden=\"true\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><div class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Finaliza en 05:38:09</div></div></span><a class=\"a-link-normal DealLink-module__dealLink_3v4tPYOP4qJj9bdiy0xAT a-color-base a-text-normal\" href=\"https://www.amazon.es/proscenic-P12-Aspiradora-Anti-enredos-VertectTM/dp/B0BQ68H284?pf_rd_r=Y0KCHM504D0X5FJK6SEB&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_tlt_0_b888d7c2_dt_sl14_3d\"><div class=\"DealContent-module__truncate_sWbxETx42ZPStTc9jwySW\">proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche</div></a><div class=\"a-row a-spacing-mini a-spacing-top-mini\"><span class=\"a-size-mini\"><div class=\"a-row a-spacing-top-micro\"><div class=\"ClaimedBar-module__bar_dm5aQ4mEyoaAHPKmolQmj\"><div class=\"ClaimedBar-module__filledBar_1RO2f4X1ENHj4qsxa7d6Ru\" style=\"width: 25%;\"></div></div><div class=\"a-row a-spacing-top-micro\"><span class=\"ClaimedBar-module__timerAndPercent_1W9_nt8c4k-Wlr-jz6Ak0f\"><div class=\"ClaimedBar-module__claimedPercentage_3qHVj_qhJeDemUDuoEw6-N\">25% solicitado</div></span></div></div></span></div></div></div>",
        "//div[starts-with(@class, 'BadgeAutomatedLabel-module__badgeAutomatedLabel')]",
        15
    )]
    public async void Should_Extract_Disccount(
        string inputHtml,
        string filter,
        int resultHtml)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        int expected = await _sut.ExtractDisccountAsync(
            htmlDocument.DocumentNode,
            filter
        );


        resultHtml.Should().Be(expected);
    }

    [Theory]
    [InlineData("<div aria-label=\"Oferta: proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche; \" class=\"DealCard-module__card_1u9yKYV4EIA-fL4ibeMVIU DealCard-module__cardWithoutActionButton_1K_FldevdoXxE8uy5pzBmr\" data-testid=\"deal-card\" data-deal-id=\"b888d7c2\" data-csa-c-type=\"item\" data-csa-c-item-type=\"deal\" data-csa-c-item-id=\"amzn1.deal.b888d7c2\" data-csa-c-painter=\"deals-grid\" data-csa-c-posx=\"1\" data-csa-c-owner=\"DealsX\" data-csa-c-id=\"nzbsql-gw0xeb-xmp7fe-drmw48\"><a class=\"a-link-normal DealCard-module__linkOutlineOffset_2fc037WfeGSjbFp1CAhOUn\" href=\"https://www.amazon.es/proscenic-P12-Aspiradora-Anti-enredos-VertectTM/dp/B0BQ68H284?pf_rd_r=Y0KCHM504D0X5FJK6SEB&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_img_0_b888d7c2_dt_sl14_3d\"><div class=\"DealCard-module__cardImageVertical_1m9E6mjbE6UbrGJwvn6GKM DealCard-module__imageWithPadding_Qk9F2b8bUeXPk8FUBnSVG\"><div class=\"a-image-container a-dynamic-image-container aok-align-center-horizontally DealImage-module__image_1aM-S1pMSsajamWgCRXa6y DealImage-module__imageAspectRatioFix_DJdrM5BSpMhSiPB6czCA4\"><img alt=\"proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para...\" src=\"https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF226,226_FMjpg_.jpg\" class=\"DealImage-module__imageObjectFit_1G4pEkUEzo9WEnA3Wl0XFv\" data-a-hires=\"https://m.media-amazon.com/images/I/41AjwlRT4DL._AC_UF452,452_FMjpg_.jpg\"></div></div></a><div class=\"DealCard-module__contentWithPadding_1mEcEYf1DvbvZJ9zcQCxtw\"><span aria-live=\"off\" class=\"a-size-mini a-color-base\"><div class=\"BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><div class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Finaliza en 05:38:09</div></div><div class=\"BadgeAutomated-module__badgeLayoutCheck_1J0nKx-ocgm90oYWcNYv5F BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\" aria-hidden=\"true\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><div class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Finaliza en 05:38:09</div></div></span><a class=\"a-link-normal DealLink-module__dealLink_3v4tPYOP4qJj9bdiy0xAT a-color-base a-text-normal\" href=\"https://www.amazon.es/proscenic-P12-Aspiradora-Anti-enredos-VertectTM/dp/B0BQ68H284?pf_rd_r=Y0KCHM504D0X5FJK6SEB&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_tlt_0_b888d7c2_dt_sl14_3d\"><div class=\"DealContent-module__truncate_sWbxETx42ZPStTc9jwySW\">proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche</div></a><div class=\"a-row a-spacing-mini a-spacing-top-mini\"><span class=\"a-size-mini\"><div class=\"a-row a-spacing-top-micro\"><div class=\"ClaimedBar-module__bar_dm5aQ4mEyoaAHPKmolQmj\"><div class=\"ClaimedBar-module__filledBar_1RO2f4X1ENHj4qsxa7d6Ru\" style=\"width: 25%;\"></div></div><div class=\"a-row a-spacing-top-micro\"><span class=\"ClaimedBar-module__timerAndPercent_1W9_nt8c4k-Wlr-jz6Ak0f\"><div class=\"ClaimedBar-module__claimedPercentage_3qHVj_qhJeDemUDuoEw6-N\">25% solicitado</div></span></div></div></span></div></div></div>",
        "aria-label",
        "Oferta: proscenic P12 Aspiradora sin Cable, 33KPa Escoba Aspiradora sin Cable, Anti-enredos, LED Vertect™ Verde,Hata 60 mins, para Mascotas/Alfombras/Coche; "
    )]
    public async void Should_Extract_Atribute(
        string inputHtml,
        string filter,
        string resultHtml)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        string expected = await _sut.ExtractAttributeValueAsync(
            htmlDocument.DocumentNode,
            filter
        );


        resultHtml.Should().Be(expected);
    }

    [Theory]
    [InlineData("<div class=\"DealGridItem-module__dealItemContent_1vFddcq1F8pUxM8dd9FW32\"><div aria-label=\"Oferta: Inateck 360° Protección Funda 13-16 Pulgadas; \" class=\"DealCard-module__card_1u9yKYV4EIA-fL4ibeMVIU DealCard-module__cardWithoutActionButton_1K_FldevdoXxE8uy5pzBmr\" data-testid=\"deal-card\" data-deal-id=\"498bd1a4\" data-csa-c-type=\"item\" data-csa-c-item-type=\"deal\" data-csa-c-item-id=\"amzn1.deal.498bd1a4\" data-csa-c-painter=\"deals-grid\" data-csa-c-posx=\"58\" data-csa-c-owner=\"DealsX\" data-csa-c-id=\"3ukta2-9bjyy7-pxibrx-s8f1o1\"><a class=\"a-link-normal DealCard-module__linkOutlineOffset_2fc037WfeGSjbFp1CAhOUn\" href=\"https://www.amazon.es/Inateck-Protecci%C3%B3n-Compatible-2020M1-2018-2020M1-2016/dp/B09CD8Z4Q4?pf_rd_r=F6MXMJFXYAR9JQY8GP9T&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_img_57_498bd1a4_dt_sl14_3d\"><div class=\"DealCard-module__cardImageVertical_1m9E6mjbE6UbrGJwvn6GKM DealCard-module__imageWithPadding_Qk9F2b8bUeXPk8FUBnSVG\"><div class=\"a-image-container a-dynamic-image-container aok-align-center-horizontally DealImage-module__image_1aM-S1pMSsajamWgCRXa6y DealImage-module__imageAspectRatioFix_DJdrM5BSpMhSiPB6czCA4\"><img alt=\"Inateck 360° Protección Funda 13-16 Pulgadas\" src=\"https://m.media-amazon.com/images/I/61R-88bYsWS._AC_UF226,226_FMjpg_.jpg\" class=\"DealImage-module__imageObjectFit_1G4pEkUEzo9WEnA3Wl0XFv\" data-a-hires=\"https://m.media-amazon.com/images/I/61R-88bYsWS._AC_UF452,452_FMjpg_.jpg\"></div></div></a><div class=\"DealCard-module__contentWithPadding_1mEcEYf1DvbvZJ9zcQCxtw\"><span aria-live=\"off\" class=\"a-size-mini a-color-base\"><div class=\"BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><time class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" role=\"timer\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Oferta</time></div><div class=\"BadgeAutomated-module__badgeLayoutCheck_1J0nKx-ocgm90oYWcNYv5F BadgeAutomated-module__badgeOneLineContainer_yYupgq1lKxb5h3bfDqA-B\" aria-hidden=\"true\"><div class=\"BadgeAutomatedLabel-module__badgeAutomatedLabel_2Teem9LTaUlj6gBh5R45wd\" style=\"color: rgb(255, 255, 255); background: rgb(204, 12, 57);\">-15%</div><time class=\"DealMessaging-module__dealMessaging_1EIwT6BUaB6vCKvPVEbAEV\" role=\"timer\" style=\"color: rgb(204, 12, 57); background: rgb(255, 255, 255);\">Oferta</time></div></span><a class=\"a-link-normal DealLink-module__dealLink_3v4tPYOP4qJj9bdiy0xAT a-color-base a-text-normal\" href=\"https://www.amazon.es/Inateck-Protecci%C3%B3n-Compatible-2020M1-2018-2020M1-2016/dp/B09CD8Z4Q4?pf_rd_r=F6MXMJFXYAR9JQY8GP9T&amp;pf_rd_t=Events&amp;pf_rd_i=deals&amp;pf_rd_p=9406c473-d65f-4512-bc20-ca3dc2632f3d&amp;pf_rd_s=slot-14&amp;ref=dlx_deals_gd_dcl_tlt_57_498bd1a4_dt_sl14_3d\"><div class=\"DealContent-module__truncate_sWbxETx42ZPStTc9jwySW\">Inateck 360° Protección Funda 13-16 Pulgadas</div></a></div></div></div>",
        ".//div[starts-with(@class, 'DealContent-module__truncate')]",
        "Inateck 360° Protección Funda 13-16 Pulgadas"
    )]
    public async void Should_Extract_Text(
        string inputHtml,
        string filter,
        string resultHtml)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        string expected = await _sut.ExtractTextAsync(
            htmlDocument.DocumentNode,
            filter
        );


        resultHtml.Should().Be(expected);
    }
}
