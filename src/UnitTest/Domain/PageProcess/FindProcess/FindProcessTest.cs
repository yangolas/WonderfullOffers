using FluentAssertions;
using HtmlAgilityPack;
using WonderfullOffers.Domain.Contracts.Domain.Processors.FindProcessBase;
using WonderfullOffers.Tests.UnitTest.Hosting;

namespace WonderfullOffers.Tests.UnitTest.Domain.PageProcess.FindProcess;

public class FindProcessTest
{
    private readonly Host _host;
    private readonly IFindProcess _sut;
    public FindProcessTest()
    {
        _host = new();
        _sut = _host.GetService<IFindProcess>();
    }

    [Theory]
    [InlineData("<div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstancelL__6qKtjH3yiU5iptM__g\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_0\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas flash</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/gp/goldbox/?ie=UTF8&amp;ref_=sv__2&amp;deals-widget=%257B%2522version%2522%253A1%252C%2522viewIndex%2522%253A0%252C%2522presetId%2522%253A%2522deals-collection-lightning-deals%2522%252C%2522dealType%2522%253A%2522LIGHTNING_DEAL%2522%252C%2522sorting%2522%253A%2522BY_SCORE%2522%257D&amp;pd_rd_w=LZtdd&amp;content-id=amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_p=7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas flash\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_379x304_es-es._SY304_CB589219091_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_758x608_es-es._SY608_CB589219091_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div><div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstance6omTwcdaI9xPXjKMwaSyVA\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_7\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas en Outlet</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/b/?ie=UTF8&amp;node=2328172031&amp;ref_=nav_em_allpf_d_outlet_0_1_1_34&amp;pd_rd_w=ruRYV&amp;content-id=amzn1.sym.ebe7489d-9c43-4c65-ad34-3dd827c1c398&amp;pf_rd_p=ebe7489d-9c43-4c65-ad34-3dd827c1c398&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas en Outlet\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_outlet_379x304_es-es._SY304_CB589218929_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_outlet_758x608_es-es._SY608_CB589218934_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div>",
        new string[] { "ofertas flash", "ofertas en outlet" })
    ]
    public async void Should_Get_True_Node_Has_The_Text_The_Specific_Text(
        string inputHtml,
        string [] filters)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        bool expected = await _sut.HasNodesToLinkAsync(
            htmlDocument.DocumentNode,
            filters.ToList());

        expected.Should().BeTrue();
    }

    [Theory]
    [InlineData("<div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstancelL__6qKtjH3yiU5iptM__g\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_0\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas flash</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/gp/goldbox/?ie=UTF8&amp;ref_=sv__2&amp;deals-widget=%257B%2522version%2522%253A1%252C%2522viewIndex%2522%253A0%252C%2522presetId%2522%253A%2522deals-collection-lightning-deals%2522%252C%2522dealType%2522%253A%2522LIGHTNING_DEAL%2522%252C%2522sorting%2522%253A%2522BY_SCORE%2522%257D&amp;pd_rd_w=LZtdd&amp;content-id=amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_p=7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas flash\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_379x304_es-es._SY304_CB589219091_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_758x608_es-es._SY608_CB589219091_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div><div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstance6omTwcdaI9xPXjKMwaSyVA\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_7\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas en Outlet</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/b/?ie=UTF8&amp;node=2328172031&amp;ref_=nav_em_allpf_d_outlet_0_1_1_34&amp;pd_rd_w=ruRYV&amp;content-id=amzn1.sym.ebe7489d-9c43-4c65-ad34-3dd827c1c398&amp;pf_rd_p=ebe7489d-9c43-4c65-ad34-3dd827c1c398&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas en Outlet\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_outlet_379x304_es-es._SY304_CB589218929_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_outlet_758x608_es-es._SY608_CB589218934_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div>",
        "//div[contains(@class, 'a-cardui') and contains(@class, '_fluid-fat-image')]",
        "<div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstancelL__6qKtjH3yiU5iptM__g\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_0\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas flash</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/gp/goldbox/?ie=UTF8&amp;ref_=sv__2&amp;deals-widget=%257B%2522version%2522%253A1%252C%2522viewIndex%2522%253A0%252C%2522presetId%2522%253A%2522deals-collection-lightning-deals%2522%252C%2522dealType%2522%253A%2522LIGHTNING_DEAL%2522%252C%2522sorting%2522%253A%2522BY_SCORE%2522%257D&amp;pd_rd_w=LZtdd&amp;content-id=amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_p=7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas flash\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_379x304_es-es._SY304_CB589219091_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_758x608_es-es._SY608_CB589219091_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div>"
    )]
    public async void Should_Get_Node_Offer(
        string inputHtml,
        string filter,
        string result)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        HtmlNode expected = await _sut.FindNodeAsync(
            htmlDocument.DocumentNode,
            filter);

        expected.OuterHtml.Should().BeEquivalentTo(result);
    }

    [Theory]
    [InlineData("<div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstancelL__6qKtjH3yiU5iptM__g\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_0\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas flash</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/gp/goldbox/?ie=UTF8&amp;ref_=sv__2&amp;deals-widget=%257B%2522version%2522%253A1%252C%2522viewIndex%2522%253A0%252C%2522presetId%2522%253A%2522deals-collection-lightning-deals%2522%252C%2522dealType%2522%253A%2522LIGHTNING_DEAL%2522%252C%2522sorting%2522%253A%2522BY_SCORE%2522%257D&amp;pd_rd_w=LZtdd&amp;content-id=amzn1.sym.7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_p=7d79bf2b-4e72-4144-a0f7-58bd209cc2de&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas flash\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_379x304_es-es._SY304_CB589219091_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_deals_758x608_es-es._SY608_CB589219091_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div><div class=\"a-cardui _fluid-fat-image-link-v2_style_fluidFatImageLink__1nw4J\" data-a-card-type=\"basic\" id=\"CardInstance6omTwcdaI9xPXjKMwaSyVA\" data-card-metrics-id=\"fluid-fat-image-link-v2_desktop-gateway-atf_7\"><div class=\"a-cardui-header\"><h2 class=\"a-color-base headline truncate-2line\">Ofertas en Outlet</h2></div><a class=\"a-link-normal _fluid-fat-image-link-v2_style_mergedLinks__10JqZ\" href=\"/b/?ie=UTF8&amp;node=2328172031&amp;ref_=nav_em_allpf_d_outlet_0_1_1_34&amp;pd_rd_w=ruRYV&amp;content-id=amzn1.sym.ebe7489d-9c43-4c65-ad34-3dd827c1c398&amp;pf_rd_p=ebe7489d-9c43-4c65-ad34-3dd827c1c398&amp;pf_rd_r=FMKYK0MGJR50G420DXBA&amp;pd_rd_wg=Thop2&amp;pd_rd_r=e5a6499d-29a9-445e-a335-0746725cb9ee\"><div class=\"_fluid-fat-image-link-v2_style_fluidFatImageLinkBody__1LsOX\"><div class=\"a-section a-spacing-none _fluid-fat-image-link-v2_style_fluidImageContainer__2SOMr\"><img alt=\"Ofertas en Outlet\" src=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_outlet_379x304_es-es._SY304_CB589218929_.jpg\" class=\"_fluid-fat-image-link-v2_style_fluidLandscapeImage__2euAK _fluid-fat-image-link-v2_style_fluidImage__gTBjA\" data-a-hires=\"https://images-eu.ssl-images-amazon.com/images/G/30/x_site/Top_campaings_reflesh_Q3_23/xcm_banners_01_outlet_758x608_es-es._SY608_CB589218934_.jpg\"></div></div><div class=\"a-cardui-footer\"><span class=\"a-truncate see-more\" data-a-word-break=\"normal\" data-a-max-rows=\"1\" data-a-overflow-marker=\"&amp;hellip;\" style=\"line-height:1.3em !important;max-height:1.3em\" data-a-recalculate=\"false\" data-a-updated=\"true\"><span class=\"a-truncate-full a-offscreen\">Explora ahora</span><span class=\"a-truncate-cut\" aria-hidden=\"true\" style=\"height: auto;\">Explora ahora</span></span></div></a></div>",
        "//div[contains(@class, 'a-cardui') and contains(@class, '_fluid-fat-image')]",
        new string[] { "ofertas flash", "ofertas en outlet" }
    )]
    public async void Should_Get_Nodes_Links_Catalog_Offer(
        string inputHtml,
        string filterNodeNameCatalog,
        string[] filtersCatalogNames)
    {
        HtmlDocument htmlDocument = new();
        htmlDocument.LoadHtml(inputHtml);

        List<HtmlNode> expected = await _sut.FindNodesLinksCatalogOffersAsync(
            htmlDocument.DocumentNode,
            filterNodeNameCatalog,
            filtersCatalogNames.ToList());

        expected.Count.Should().Be(2);
    }

}
